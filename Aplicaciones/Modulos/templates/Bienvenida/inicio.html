{% extends "plantillaModulos.html" %}
{% load static %}
{% load i18n %}
{% block body %}
<link rel="stylesheet" href="{% static 'css/estilosInicio.css' %}">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>


<div class="contenedor-idioma-niños">
  <form action="{% url 'set_language' %}" method="post">
    {% csrf_token %}
    <input name="next" type="hidden" value="{{ request.path }}">

    <label for="language" class="label-idioma">🌍 Elige tu idioma:</label>
    <select name="language" id="language" class="select-idioma">
      <option value="es" {% if request.LANGUAGE_CODE == 'es' %}selected{% endif %}>🇪🇸 Español</option>
      <option value="qu" {% if request.LANGUAGE_CODE == 'qu' %}selected{% endif %}>🌄 Kichwa</option>
    </select>

    <button type="submit" class="btn-idioma">🎈 Cambiar idioma</button>
  </form>
</div>



<br><br>
<div class="contenedor-bienvenida-animado">
  <h2 class="titulo-bienvenida animar-titulo">
    {% trans "¡Juntos aprendemos kichwa!" %}
    <img src="{% static 'imagenes/inicio/ardilla.gif' %}" alt="ardilla" class="gif-ardilla">
  </h2>
</div>

<div class="contenedor-boton-aprender">
  <form action="{% url 'aprender' %}">
    <button type="submit" class="btn-aprender" onclick="lanzarConfeti(event)">
      🎒 ¡Vamos a aprender!
    </button>
  </form>
</div>


<div class="zona-bienvenida">
  
  <!-- Figuras animadas -->
  <div class="contenedor-figuras">
    <div class="figura" id="figura1"><img src="{% static 'imagenes/inicio/mikey_mouse.gif' %}"></div>
    <div class="figura" id="figura2"><img src="{% static 'imagenes/inicio/pato_donal.gif' %}"></div>
    <div class="figura" id="figura3"><img src="{% static 'imagenes/inicio/doraemon.gif' %}"></div>
    <div class="figura" id="figura4"><img src="{% static 'imagenes/inicio/pitufo.gif' %}"></div>
  </div>

  <!-- Galería -->
  <div class="galeria-imagenes">
    <img class="galeria-item activo" src="{% static 'imagenes/fotos_escuela/escuela.png' %}">
    <img class="galeria-item" src="{% static 'imagenes/fotos_escuela/foto1.png' %}">
    <img class="galeria-item" src="{% static 'imagenes/fotos_escuela/foto2.png' %}">
    <img class="galeria-item" src="{% static 'imagenes/fotos_escuela/foto3.png' %}">
  </div>

</div>

<script>
  function colision(rect1, rect2, margen = 10) {
    return !(
      rect1.left + rect1.width + margen < rect2.left ||
      rect1.left > rect2.left + rect2.width + margen ||
      rect1.top + rect1.height + margen < rect2.top ||
      rect1.top > rect2.top + rect2.height + margen
    );
  }

  function moverAleatorio(figura, posiciones) {
    const zona = document.querySelector(".contenedor-figuras");
    const zonaWidth = zona.clientWidth;
    const zonaHeight = zona.clientHeight;

    const figuraWidth = figura.offsetWidth;
    const figuraHeight = figura.offsetHeight;

    const margen = 20;
    const maxIntentos = 500;
    let intentos = 0;
    let nuevaPos;

    do {
      const left = Math.floor(Math.random() * (zonaWidth - figuraWidth - margen));
      const top = Math.floor(Math.random() * (zonaHeight - figuraHeight - margen));

      const nuevaCaja = {
        left: left,
        top: top,
        width: figuraWidth,
        height: figuraHeight
      };

      const colisiona = posiciones.some(pos => colision(nuevaCaja, pos, margen));
      if (!colisiona) {
        nuevaPos = nuevaCaja;
        break;
      }

      intentos++;
    } while (intentos < maxIntentos);

    if (nuevaPos) {
      posiciones.push(nuevaPos);
      figura.style.left = nuevaPos.left + "px";
      figura.style.top = nuevaPos.top + "px";
      figura.style.opacity = 0;
      setTimeout(() => figura.style.opacity = 1, 300);
    }
  }

  function iniciarMovimiento() {
    const figuras = document.querySelectorAll(".figura");
    const posiciones = [];

    figuras.forEach((figura, index) => {
      setTimeout(() => moverAleatorio(figura, posiciones), index * 300);
    });

    setInterval(() => {
      const nuevasPosiciones = [];
      figuras.forEach((figura, index) => {
        setTimeout(() => moverAleatorio(figura, nuevasPosiciones), index * 300);
      });
    }, 8000);
  }

  function rotarImagenes() {
    const imagenes = document.querySelectorAll('.galeria-item');
    let index = 0;

    setInterval(() => {
      imagenes.forEach(img => img.classList.remove("activo"));
      index = (index + 1) % imagenes.length;
      imagenes[index].classList.add("activo");
    }, 4000);
  }

  window.onload = () => {
    iniciarMovimiento();
    rotarImagenes();
  };
</script>

<script>
  function lanzarConfeti(event) {
    event.preventDefault();

    confetti({
      particleCount: 120,
      spread: 70,
      origin: { y: 0.6 }
    });

    setTimeout(() => {
      event.target.closest("form").submit();
    }, 1000);
  }
</script>


{% endblock %}
